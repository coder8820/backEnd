<!DOCTYPE html>
<html lang="en">

<%- include('../partials/head', { title: 'Your Favorites' }) %>

<body class="bg-gray-50 text-gray-800 font-sans">

    <%- include('../partials/navbar') %>

    <main class="max-w-7xl mx-auto px-6 py-12">

        <!-- Page Title -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold">Your Favorites</h2>
            <p class="text-gray-500 mt-1">
                Homes you‚Äôve saved ‚ù§Ô∏è
            </p>
        </div>

        <% if (registeredHomes && registeredHomes.length > 0) { %>

        <!-- Airbnb-style grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

            <% registeredHomes.forEach(function(home) { %>

            <div class="group bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition">

                <!-- Image -->
                <div class="relative">
                    <img src="<%= home.imageurl ? home.imageurl : '/images/home.jpg' %>"
                         class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105"
                         onerror="this.src='/images/home.jpg'" />

                    <!-- Heart Icon -->
                    <button class="absolute top-3 right-3 bg-white/90 p-2 rounded-full shadow hover:scale-110 transition">
                        ‚ù§Ô∏è
                    </button>
                </div>

                <!-- Content -->
                <div class="p-4">

                    <!-- Location + Rating -->
                    <div class="flex justify-between items-center mb-1">
                        <p class="font-medium text-sm truncate">
                            <%= home.location %>
                        </p>
                        <span class="text-sm flex items-center gap-1">
                            ‚≠ê <%= home.rating || '4.8' %>
                        </span>
                    </div>

                    <!-- Title -->
                    <h3 class="text-sm text-gray-600 truncate">
                        <%= home.housename %>
                    </h3>

                    <!-- Price -->
                    <p class="mt-2 text-sm">
                        <span class="font-semibold">$<%= home.price %></span>
                        <span class="text-gray-500"> / night</span>
                    </p>

                    <!-- Actions -->
                    <div class="mt-4 flex gap-2">
                        <button onclick="addToFavorite('<%= home.id %>', '<%= home.housename %>', '<%= home.location %>', '<%= home.price %>', '<%= home.rating %>', '<%= home.imageurl %>')"
                           class="flex-1 text-center text-sm font-medium
                                  bg-rose-500 text-white py-2 rounded-lg
                                  hover:bg-rose-600 transition">
                            ‚ù§Ô∏è Add to Favorite
                        </button>
                        <a href="/booking/<%= home.id %>"
                           class="flex-1 text-center text-sm font-medium
                                  bg-blue-500 text-white py-2 rounded-lg
                                  hover:bg-blue-600 transition">
                            Book now
                        </a>
                    </div>

                </div>
            </div>

            <% }); %>

        </div>

        <% } else { %>

        <!-- Empty State -->
        <div class="text-center mt-20">
            <p class="text-gray-500 text-lg">You haven‚Äôt saved any homes yet.</p>
            <a href="/"
               class="inline-block mt-4 text-rose-500 font-medium hover:underline">
                Explore homes
            </a>
        </div>

        <% } %>

    </main>

    <%- include('../partials/footer') %>

    <script>
        function addToFavorite(id, housename, location, price, rating, imageurl) {
            // Get existing favorites from localStorage
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            
            // Check if already in favorites
            const exists = favorites.some(fav => fav.id === id);
            
            if (exists) {
                alert('This home is already in your favorites!');
                return;
            }
            
            // Add to favorites
            const favorite = {
                id: id,
                housename: housename,
                location: location,
                price: price,
                rating: rating,
                imageurl: imageurl
            };
            
            favorites.push(favorite);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            alert('Added to your favorites! üéâ');
        }
    </script>

</body>
</html>
